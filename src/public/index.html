<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Notifications</title>
</head>

<body>
  <button onclick="subscribe()">Subscribe ðŸ””</button>
  <img width="92px" height="92px"
    src="https://escaneapet.s3.us-east-2.amazonaws.com/dba4ba47-40d3-414b-933a-ac6251b86565?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIA4FUS6ORJ2NEDV4JM%2F20231025%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20231025T015205Z&X-Amz-Expires=3600&X-Amz-Signature=7ea74588d62d55bac2cf0ea27d98995ea25b56559156917b27d33efa57342958&X-Amz-SignedHeaders=host&x-id=GetObject" />

  <script>
    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYsImlhdCI6MTY5Njk4NTMxOCwiZXhwIjoxNjk5NTc3MzE4fQ.YriKKKO69gdZfR6TPFO2o_9xkuPBA_dqqxUCPJWR0Zg"

    async function subscribe() {
      try {
        const applicationServerKey = "BA5Cef5Ot5WU_nDBWdzThi0XjU_6VCBiY35aEqo-5NFs6W3l5UNHkdkiapFpOQ1UrwTaQsRH79U_dAqTGULtXII";

        const registration = await navigator.serviceWorker.register('sw.js', {
          scope: '/'
        });

        const subscription = await registration.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey
        });

        await fetch("http://localhost:7000/notification/subscribe", {
          method: "POST",
          body: JSON.stringify(subscription),
          headers: {
            "content-type": "application/json",
            "Authorization": 'Bearer ' + token
          }
        })
          .then(res => res.json())
          .then(console.log)
          .catch(console.error);

        console.log('Subscription successful:', subscription);
      } catch (error) {
        console.error('Error during subscription:', error);
      }
    }
  </script>
</body>

</html>